{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=1640, user-scalable=no" />
  <title>주문 완료</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 1640px;
      height: 2360px;
      background-color: #5c4033;
      overflow: hidden;
    }

    .full-bg {
      width: 100%;
      height: 100%;
      background: url("{% static 'images/end.png' %}") no-repeat center center;
      background-size: cover;
      cursor: pointer;
    }
  </style>
  <script>
    // 호스트 이름이 localhost/127.0.0.1이면 로컬 포트 8002로 접속, 배포 환경에서는 원래 주소 사용
    const wsUrl =
      window.location.hostname === "127.0.0.1" || window.location.hostname === "localhost"
        ? "ws://127.0.0.1:8002"
        : "wss://6a01-49-143-8-202.ngrok-free.app";

    const socket = new WebSocket(wsUrl);

    socket.onopen = () => {
      console.log("✅ WebSocket 연결됨");
      socket.send("done_page_ready");  // 📨 서버에 준비 완료 알림
    };

    socket.onmessage = (event) => {
      const message = event.data;
      console.log("📩 서버 응답:", message);

      // 서버가 'say_payment_done' 메시지를 보내는 경우 처리
      if (message === "say_payment_done") {
        console.log("🔊 '결제 완료' 음성 재생 트리거");
        // 필요시 여기서 애니메이션이나 화면 효과를 추가할 수 있습니다.
      }
    };

    // 4.5초 뒤에 /start로 자동 이동
    setTimeout(() => {
      window.location.href = '/start';
    }, 4500);
  </script>
</head>
<body>
  <div class="full-bg"></div>
</body>
</html>
