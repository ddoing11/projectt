{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>결제 중</title>
  <script src="{% static 'js/voice_socket_main.js' %}?v=버전"></script>

  <style>
    @font-face {
      font-family: 'Hakgyoansim';
      src: url("{% static 'fonts/Hakgyoansim.ttf' %}") format('truetype');
    }
    @font-face {
      font-family: 'BMDoHyeon';
      src: url("{% static 'fonts/BMDoHyeon.ttf' %}") format('truetype');
    }
    html, body {
      margin: 0;
      padding: 0;
      width: 1315px;
      height: 1282px;
      background: white;
      font-family: 'Hakgyoansim', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .popup {
      width: 100%;
      height: 100%;
      padding: 80px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .popup h1 {
      font-size: 60px;
      font-family: 'BMDoHyeon', sans-serif;
      margin-bottom: 40px;
    }
    .popup hr {
      width: 100%;
      border: none;
      border-top: 1px solid #999;
      margin: 30px 0;
    }
    .popup .symbol {
      font-size: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 20px 0;
    }
    .popup .amount {
      font-size: 72px;
      font-family: 'BMDoHyeon', sans-serif;
      margin-left: 20px;
    }
    .popup .text {
      font-size: 48px;
      text-align: center;
      margin-top: 150px;
      font-family: 'BMDoHyeon', sans-serif;
      line-height: 2.5;
    }
    
    
  </style>
</head>

<body>

<div class="popup">
  <h1>결제</h1>
  <hr />
  <div class="symbol">
    ₩ <span class="amount" id="total-amount">0</span>
  </div>
  <hr />
  <div class="text">
    결제 중입니다.<br>
    잠시만 기다려 주세요.
  </div>
</div>

<script>
window.addEventListener("message", function(event) {
  if (event.data === "start-payment") {
    const cartData = JSON.parse(localStorage.getItem('cart') || '[]');
    let total = 0;
    cartData.forEach(item => {
      total += parseInt(item.basePrice) * parseInt(item.quantity);
    });
    document.getElementById('total-amount').textContent = total.toLocaleString();

    setTimeout(function () {
      localStorage.removeItem('cart');
      parent.window.location.href = "{% url 'done' %}";
    }, 3000);
  }
});
</script>

</body>
</html>
